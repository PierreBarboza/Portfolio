<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/header-footer.css" type="text/css" />
  <link rel="stylesheet" href="../css/cadastrarEmp.css" type="text/css" />
  <link rel="stylesheet" href="../css/alertas.css">
  <link rel="shortcut icon" href="../img/Icon-LM.png" type="image/x-icon" />
  <title>Cadastro de empresa</title>
  <script src="../js/funcoes.js"></script>
  <script src="//code.jivosite.com/widget/fICoc6GW84" async></script>
</head>

<body>
  <!------------------------------HEADER DO SITE ----------------------------------------- -->
  <div class="header-da-gestao">
    <div class="container-navbar">
      <div class="brand-sptrans">
        <!----LOGO--->
        <img src="../img/SPTrans_logo.png" alt="" width="70px" />
      </div>

      <ul class="navbar-da-gestao">
        <li class="pagina-atual">
          <a href="cadastrarEmp.html">
            Cadastrar<br />
            Empresas
          </a>
        </li>
        <li>
          <a href="empCadast-cheio.html">
            Empresas<br />
            Cadastradas
          </a>
        </li>
        <li>
          <a href="../index.html"> Sair</a>
        </li>
      </ul>
    </div>
  </div>
  <!---------------------------------CORPO DO SITE------------------------------------------>
  <div class="bannerCadastrarEmp">
    <div class="containerCadastrarEmp">
      <h1>Cadastro de Empresa</h1>
      <div class="form-boxCadastrarEmp">
        <h4>Nome da Empresa:</h4>
        <input id="input_nomeEmpresa" type="text" onclick="limparBorda_de_erro()"/>
        <h4>CNPJ:</h4>
        <input id="input_CNPJ" type="text" onclick="limparBorda_de_erro()"/>
        <h4>CEP:</h4>
        <input id="input_cep" onblur="pesquisacep(this.value);" type="text" />
        <h4>Número:</h4>
        <input id="input_numero" type="text" onclick="limparBorda_de_erro()"/>
        <h4>Rua:</h4>
        <input id="input_rua" type="text" onclick="limparBorda_de_erro()"/>        
        <h4>Bairro:</h4>
        <input id="input_bairro" type="text" onclick="limparBorda_de_erro()"/>
        <h4>Cidade:</h4>
        <input id="input_cidade" type="text" onclick="limparBorda_de_erro()"/>
        <h4>UF:</h4>
        <input id="input_estado" type="text" onclick="limparBorda_de_erro()"/>       
        <h4>Telefone (1):</h4>
        <input id="input_telefone1" type="text" onclick="limparBorda_de_erro()"/>
        <h4>Telefone (2):</h4>
        <input id="input_telefone2" type="text" onclick="limparBorda_de_erro()"/>

        <div id="caixa_de_alerta_2" class="box_alert_2">
          <div id="mensagem_erro_2" class="alerta_erro_2"> <!---Aqui Aparece a Mensagem de Validação (ALERT) ---> </div>
        </div>

      </div>
      <div class="containerbtn">
        <a onclick="a_limpar()">Limpar</a>
        <a onclick="cadastro()">Cadastrar</a>
      </div>
    </div>
    
  </div>
  
  <!---------------------------------RODAPÉ DO SITE------------------------------------------>
  <div class="footer">
    <div class="container">
      <div class="Boxtext">
        <h2>Saiba Mais</h2>
        <p><a href="termos-de-uso.html">Termos de Uso</a></p>
      </div>
      <div class="Boxtext">
        <h2>Atendimento</h2>
        <p>suporte@logmobility.com</p>
        <p>(11) 1234-5678</p>
      </div>
      <div class="RedesSocias">
        <h2>Redes Sociais</h2>
        <div class="BoxImgs">
          <img src="../img/logo-instagram.png" width="30px" alt="" />
          <img src="../img/logo-facebook.png" width="30px" alt="" />
          <img src="../img/logo-twitter.png" width="30px" alt="" />
        </div>
      </div>
    </div>

    <div class="direitos">
      Log Mobility - 2022 Todos os direitos reservados
    </div>
  </div>
</body>
</html>
<script>
  function cadastro() { 
      var nomeEmpresaCadasVar = input_nomeEmpresa.value;
      var cnpjEmpresaCadasVar = input_CNPJ.value;
      var ruaEmpresaCadasVar = input_rua.value;
      var numeroEmpresaCadasVar = input_numero.value;
      var bairroEmpresaCadasVar = input_bairro.value;
      var cidadeEmpresaCadasVar = input_cidade.value;
      var estadoEmpresaCadasVar = input_estado.value;
      var cepEmpresaCadasVar = input_cep.value;
      var tel1EmpresaCadasVar = input_telefone1.value;
      var tel2EmpresaCadasVar = input_telefone2.value;


      //Validações dos dados
      if (
        nomeEmpresaCadasVar == "" || cnpjEmpresaCadasVar == "" || ruaEmpresaCadasVar == "" || numeroEmpresaCadasVar == "" ||
        bairroEmpresaCadasVar == "" || cidadeEmpresaCadasVar == "" || estadoEmpresaCadasVar == "" || cepEmpresaCadasVar == "" ||
        tel1EmpresaCadasVar == "" || tel2EmpresaCadasVar == ""
        ) {
          mensagem_erro_2.innerHTML = `<p> Existem campos não preenchidos ! </p>`
          document.getElementById("mensagem_erro_2").style.display="flex";
          document.getElementById("input_nomeEmpresa").style.backgroundColor="#ff9696";
          document.getElementById("input_CNPJ").style.backgroundColor="#ff9696";
          document.getElementById("input_rua").style.backgroundColor="#ff9696";
          document.getElementById("input_numero").style.backgroundColor="#ff9696";
          document.getElementById("input_bairro").style.backgroundColor="#ff9696";
          document.getElementById("input_cidade").style.backgroundColor="#ff9696";
          document.getElementById("input_estado").style.backgroundColor="#ff9696";
          document.getElementById("input_cep").style.backgroundColor="#ff9696";
          document.getElementById("input_telefone1").style.backgroundColor="#ff9696";
          document.getElementById("input_telefone2").style.backgroundColor="#ff9696";

      } else if (cnpjEmpresaCadasVar.length != 15 ){

        mensagem_erro_2.innerHTML = `<p> CNPJ Inválido ! </p>`
        document.getElementById("mensagem_erro_2").style.display="flex";
        document.getElementById("input_CNPJ").style.backgroundColor="#ff9696";

      } else {
        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js              
                nomeEmpresaCadasServer : nomeEmpresaCadasVar,
                cnpjEmpresaCadasServer : cnpjEmpresaCadasVar,
                ruaEmpresaCadasServer : ruaEmpresaCadasVar,
                numeroEmpresaCadasServer : numeroEmpresaCadasVar, 
                bairroEmpresaCadasServer : bairroEmpresaCadasVar,
                cidadeEmpresaCadasServer : cidadeEmpresaCadasVar, 
                estadoEmpresaCadasServer : estadoEmpresaCadasVar, 
                cepEmpresaCadasServer : cepEmpresaCadasVar, 
                tel1EmpresaCadasServer : tel1EmpresaCadasVar, 
                tel2EmpresaCadasServer : tel2EmpresaCadasVar,         
            })
        })
        window.location.href = "cadastroUsuario.html" 
      }
      
  }
  function limparBorda_de_erro(){
    document.getElementById("input_nomeEmpresa").style.backgroundColor="#fff";
    document.getElementById("input_CNPJ").style.backgroundColor="#fff";
    document.getElementById("input_rua").style.backgroundColor="#fff";
    document.getElementById("input_numero").style.backgroundColor="#fff";
    document.getElementById("input_bairro").style.backgroundColor="#fff";
    document.getElementById("input_cidade").style.backgroundColor="#fff";
    document.getElementById("input_estado").style.backgroundColor="#fff";
    document.getElementById("input_cep").style.backgroundColor="#fff";
    document.getElementById("input_telefone1").style.backgroundColor="#fff";
    document.getElementById("input_telefone2").style.backgroundColor="#fff";
    mensagem_erro_2.innerHTML = ``
    document.getElementById("mensagem_erro_2").style.display="none";
  }

  function a_limpar(){
    input_nomeEmpresa.value = "";
    input_CNPJ.value = "";
    input_rua.value = "";
    input_numero.value = "";
    input_bairro.value = "";
    input_cidade.value = "";
    input_estado.value = "";
    input_CEP.value = "";
    input_telefone1.value = "";
    input_telefone2.value = "";
  }
  function limpa_formulário_cep() {
            //Limpa valores do formulário de cep.
            document.getElementById('input_rua').value=("");
            document.getElementById('input_bairro').value=("");
            document.getElementById('input_cidade').value=("");
            document.getElementById('input_estado').value=("");
            
    }

    function meu_callback(conteudo) {
        if (!("erro" in conteudo)) {
            //Atualiza os campos com os valores.
            document.getElementById('input_rua').value=(conteudo.logradouro);
            document.getElementById('input_bairro').value=(conteudo.bairro);
            document.getElementById('input_cidade').value=(conteudo.localidade);
            document.getElementById('input_estado').value=(conteudo.uf);
            
        } //end if.
        else {
            //CEP não Encontrado.
            limpa_formulário_cep();
            alert("CEP não encontrado.");
        }
    }
        
    function pesquisacep(valor) {

        //Nova variável "cep" somente com dígitos.
        var cep = valor.replace(/\D/g, '');

        //Verifica se campo cep possui valor informado.
        if (cep != "") {

            //Expressão regular para validar o CEP.
            var validacep = /^[0-9]{8}$/;

            //Valida o formato do CEP.
            if(validacep.test(cep)) {

                //Preenche os campos com "..." enquanto consulta webservice.
                document.getElementById('input_rua').value="...";
                document.getElementById('input_bairro').value="...";
                document.getElementById('input_cidade').value="...";
                document.getElementById('input_estado').value="...";
                

                //Cria um elemento javascript.
                var script = document.createElement('script');

                //Sincroniza com o callback.
                script.src = 'https://viacep.com.br/ws/'+ cep + '/json/?callback=meu_callback';

                //Insere script no documento e carrega o conteúdo.
                document.body.appendChild(script);

            } //end if.
            else {
                //cep é inválido.
                limpa_formulário_cep();
                alert("Formato de CEP inválido.");
            }
        } //end if.
        else {
            //cep sem valor, limpa formulário.
            limpa_formulário_cep();
        }
    };


</script>